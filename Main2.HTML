<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego Matemático: Atina a la Diana</title>
<style>
    body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 20px;
    }
    h1, p {
        text-align: center;
    }
    #coordenadasDiana {
        margin: 10px 0 15px 0;
        font-size: 1.2em;
        font-weight: bold;
        color: #333;
        background-color: #f0f0f0;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ddd;
    }
    #controles {
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
    }
    .grupo-input {
        margin: 5px 15px;
    }
    label {
        margin-right: 5px;
    }
    input[type="number"] {
        width: 60px;
    }
    button {
        margin: 5px;
        padding: 8px 15px;
        cursor: pointer;
        border: 1px solid #555;
        border-radius: 5px;
    }
    #iniciarBtn {
        background-color: #4CAF50; /* Verde */
        color: white;
    }
    #cambiarNivelBtn {
        background-color: #008CBA; /* Azul */
        color: white;
    }
    canvas {
        border: 1px solid black;
        background-color: #f9f9f9;
    }
</style>
</head>
<body>

<h1>Juego Matemático: Atina a la Diana</h1>
<p>Ajusta la parábola <b>y = ax² + bx + c</b> para que la pelota golpee la diana azul.</p>

<div id="coordenadasDiana"></div>

<div id="controles">
    <div class="grupo-input">
        <label for="a">a:</label>
        <input type="number" id="a" value="-0.1" step="0.01">
    </div>
    <div class="grupo-input">
        <label for="b">b:</label>
        <input type="number" id="b" value="2" step="0.1">
    </div>
    <div class="grupo-input">
        <label for="c">c:</label>
        <!-- Atributo 'min' añadido para restringir el valor mínimo a 0 -->
        <input type="number" id="c" value="0" step="0.1" min="0">
    </div>
    <button id="iniciarBtn">¡Lanzar!</button>
    <button id="cambiarNivelBtn">Cambiar de Nivel</button>
</div>

<canvas id="lienzoJuego" width="800" height="500"></canvas>

<script>
    // --- REFERENCIAS A ELEMENTOS DEL DOM ---
    const canvas = document.getElementById('lienzoJuego');
    const ctx = canvas.getContext('2d');
    const iniciarBtn = document.getElementById('iniciarBtn');
    const cambiarNivelBtn = document.getElementById('cambiarNivelBtn');
    const coordenadasDisplay = document.getElementById('coordenadasDiana');
    const aInput = document.getElementById('a');
    const bInput = document.getElementById('b');
    const cInput = document.getElementById('c');

    // --- CONFIGURACIÓN DEL JUEGO ---
    const anchoCanvas = canvas.width;
    const altoCanvas = canvas.height;
    const escala = 25;
    const centroX = 50;
    const centroY = altoCanvas - 50;
    const maxYValue = Math.floor((centroY) / escala);
    
    // --- VARIABLES DE ESTADO DEL JUEGO ---
    let animacionId;
    let x_pelota;
    let targetX, targetY;
    let juegoActivo = false;

    // --- FUNCIONES DE DIBUJO ---
    function dibujarEjes() {
        ctx.beginPath();
        ctx.moveTo(0, centroY);
        ctx.lineTo(anchoCanvas, centroY);
        ctx.moveTo(centroX, 0);
        ctx.lineTo(centroX, altoCanvas);
        ctx.strokeStyle = '#ccc';
        ctx.lineWidth = 1;
        ctx.stroke();
    }

    function dibujarMarcasDiana(x, y) {
        const colorMarca = '#6a0dad';
        ctx.strokeStyle = colorMarca;
        ctx.lineWidth = 2;

        const canvasX = centroX + x * escala;
        ctx.beginPath();
        ctx.moveTo(canvasX, centroY - 6);
        ctx.lineTo(canvasX, centroY + 6);
        ctx.stroke();

        const canvasY = centroY - y * escala;
        ctx.beginPath();
        ctx.moveTo(centroX - 6, canvasY);
        ctx.lineTo(centroX + 6, canvasY);
        ctx.stroke();

        ctx.fillStyle = colorMarca;
        ctx.font = 'bold 14px Arial';
        
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText(x, canvasX, centroY + 10);

        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillText(y, centroX - 10, canvasY);
    }

    function dibujarPelota(x, y) {
        ctx.beginPath();
        ctx.arc(centroX + x * escala, centroY - y * escala, 5, 0, Math.PI * 2);
        ctx.fillStyle = 'red';
        ctx.fill();
        ctx.closePath();
    }

    function dibujarDiana(x, y) {
        ctx.beginPath();
        ctx.arc(centroX + x * escala, centroY - y * escala, 8, 0, Math.PI * 2);
        ctx.fillStyle = 'blue';
        ctx.fill();
        ctx.strokeStyle = 'darkblue';
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.closePath();
    }
    
    // --- FUNCIONES DE LÓGICA DEL JUEGO ---
    function generarNuevaDiana() {
        const maxGraphX = (anchoCanvas - centroX) / escala - 2;
        const maxGraphY = maxYValue - 2;
        
        targetX = Math.floor(Math.random() * (maxGraphX - 5) + 5);
        targetY = Math.floor(Math.random() * (maxGraphY - 3) + 3);
    }

    function reiniciarNivel() {
        cancelAnimationFrame(animacionId);
        x_pelota = 0;
        juegoActivo = false;
        
        ctx.clearRect(0, 0, anchoCanvas, altoCanvas);
        dibujarEjes();
        dibujarMarcasDiana(targetX, targetY);
        dibujarDiana(targetX, targetY);
        const c = parseFloat(cInput.value) || 0;
        dibujarPelota(0, c);
        
        coordenadasDisplay.textContent = `Objetivo actual: (X: ${targetX}, Y: ${targetY})`;
    }

    function animar() {
        if (!juegoActivo) return;

        const a = parseFloat(aInput.value);
        const b = parseFloat(bInput.value);
        const c = parseFloat(cInput.value);

        ctx.clearRect(0, 0, anchoCanvas, altoCanvas);
        dibujarEjes();
        dibujarMarcasDiana(targetX, targetY);
        dibujarDiana(targetX, targetY);

        const y_pelota = a * x_pelota * x_pelota + b * x_pelota + c;
        dibujarPelota(x_pelota, y_pelota);

        const distancia = Math.sqrt(Math.pow(x_pelota - targetX, 2) + Math.pow(y_pelota - targetY, 2));

        if (distancia < 0.7) { 
            juegoActivo = false;
            alert("¡GANASTE! ¡Le diste a la diana!");
            generarNuevaDiana(); 
            reiniciarNivel();
            return;
        }

        if (x_pelota > targetX + 1 && y_pelota <= 0) {
            juegoActivo = false;
            alert("¡PERDISTE! La pelota pasó de largo. ¡Inténtalo de nuevo!");
            reiniciarNivel();
            return;
        }
        
        const x_pelota_canvas = centroX + x_pelota * escala;
        if (x_pelota_canvas > anchoCanvas) {
             juegoActivo = false;
            alert("¡PERDISTE! La pelota se salió de la pantalla. ¡Inténtalo de nuevo!");
            reiniciarNivel();
            return;
        }

        x_pelota += 0.1;

        animacionId = requestAnimationFrame(animar);
    }
    
    // --- EVENT LISTENERS ---
    iniciarBtn.addEventListener('click', () => {
        if (juegoActivo) return;
        
        if (aInput.value === '' || bInput.value === '' || cInput.value === '') {
            alert("Por favor, introduce valores para a, b y c.");
            return;
        }
        
        reiniciarNivel();
        juegoActivo = true;
        animar();
    });

    cambiarNivelBtn.addEventListener('click', () => {
        generarNuevaDiana();
        reiniciarNivel();
    });

    // --- LÓGICA MODIFICADA ---
    // Este listener ahora valida tanto el límite superior como el inferior.
    cInput.addEventListener('input', () => {
        let cValue = parseFloat(cInput.value);

        if (!isNaN(cValue)) { // Solo si es un número válido
            if (cValue > maxYValue) {
                cInput.value = maxYValue; // Corregimos si es mayor al máximo
            } else if (cValue < 0) {
                cInput.value = 0; // Corregimos si es menor que 0
            }
        }
        
        reiniciarNivel();
    });

    // --- ESTADO INICIAL AL CARGAR LA PÁGINA ---
    // Establecemos los atributos 'min' y 'max' en el input 'c' dinámicamente
    cInput.setAttribute('max', maxYValue);
    cInput.setAttribute('min', 0);
    generarNuevaDiana();
    reiniciarNivel();

</script>

</body>
</html>